name: Archive Meetings

on:
  schedule:
    - cron: '30 23 * * 1-5'
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for running'
        required: false
        default: 'Debugging workflow'

jobs:
  archive-task:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '22'
      - run: npm install
      - name: Copy W3C CCG configuration
        run: cp config.js node_modules/cg-archiver
      - name: Setup Google API credentials
        run: echo '${{ secrets.CREDENTIALS_JSON }}' > node_modules/cg-archiver/credentials.json
      - name: Download logs and minutes
        working-directory: node_modules/cg-archiver
        run: ./cg-archiver
      - name: Send logs and minutes to archival server
        working-directory: node_modules/cg-archiver
        run: cg-archiver -u
